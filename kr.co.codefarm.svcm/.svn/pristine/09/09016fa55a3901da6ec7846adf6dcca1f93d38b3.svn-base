<script type="text/javascript" src="/app-assets/js/api/amanager/acqmgmt.api.js"></script>
<script type="text/javascript" src="/app-assets/js/api/amanager/commonsearch.api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>


<h3 style="margin-top:-20px;">자산관리 > 취득 > 물품취득관리 > <strong>자산취득관리</strong></h3>
<section class="sub_cont_box" id="app" style="margin-top:10px;">
	<section class="cont_box" v-if="!mainList.currentRow">
		<div class="box-type03">
			<div class="row form-row">
				<div class="form-group col s12 l2">
					<label for="pServiceType" class="label-type01">자산취득부서</label>
					<div class="select-group" style="display: flex; align-items: center;">
						<select class="size-m" v-model="pAcqDeptCd" name="pAcqDeptCd" id="pAcqDeptCd">
							<option v-for="(item, index) in deptCodeSet.data" :value="item.ORGNZT_ID">{{item.ORGNZT_NM}}
							</option>
						</select>
						<button type="button" class="btn type02 size-s" @click=""
							style="width: 20px; display: flex; justify-content: center; align-items: center;">
							<span class="icon icon-search"></span>
						</button>
					</div>
				</div>

				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">자산취득번호</label>
					<input type="text" v-model="pAssetAcqNo" id="pAssetAcqNo" name="pAssetAcqNo" class="size-m"
						v-on:keyup.13="search()">
				</div>

				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">물 품 명</label>
					<input type="text" v-model="pAssetClKoNm" id="pAssetClKoNm" name="pAssetClKoNm" class="size-m"
						v-on:keyup.13="search()">
				</div>

				<div class="form-group col s12 l2">
					<label for="frdt" class="label-type01">취득일자</label>
					<div class="date-group" style="display: flex; align-items: center;">
						<div class="row form-row">
							<div class="form-group col s12 l5">
								<div class="date-form-wrap">
									<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
									<date-picker :value="acqDt_S"
										@input="function(value){ acqDt_S = value }"></date-picker>
									<input id="pAcqDt_Start" type="hidden" name="targetname" data-vv-as="날짜 "
										v-model="acqDt_S">
								</div>
							</div>
							<div class="form-group col s12 l5">
								<div class="date-form-wrap">
									<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
									<date-picker :value="acqDt_E"
										@input="function(value){ acqDt_E = value }"></date-picker>
									<input id="pAcqDt_End" type="hidden" name="targetname" data-vv-as="날짜 "
										v-model="acqDt_E">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">물품목록번호</label>
					<div class="input-group" style="display: flex; align-items: center;">
						<input type="text" v-model="pAssetClNo" id="pAssetClNo" name="pAssetClNo" class="size-m"
							v-on:keyup.13="search()">
						<span style="padding: 5px;">-</span>
						<input type="text" v-model="pAssetStndNo" id="pAssetStndNo" name="pAssetStndNo" class="size-m"
							v-on:keyup.13="search()">
						<button type="button" class="btn type02 size-s" @click.prevent="modal_open('assetSearchModal');return false;"
							style="width: 20px; display: flex; justify-content: center; align-items: center;">
							<span class="icon icon-search"></span>
						</button>
					</div>
				</div>
			</div>
			
			<div class="row form-row">
				<div class="form-group col s12 l2">
					<label for="pServiceType" class="label-type01">반영여부</label>
					<div class="select-group" style="display: flex; align-items: center;">
						<select class="size-m" v-model="pAcqRflcAt" name="pAcqRflcAt" id="pAcqRflcAt">
							<option value="ALL">-전체-</option>
							<option value="N">미반영</option>
							<option value="Y">반영</option>
						</select>
					</div>
				</div>
			
				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">기관자산번호</label>
					<div class="input-group" style="display: flex; align-items: center;">
						<input type="text" v-model="pInstAssetMgmtNo_S" id="pInstAssetMgmtNo_S" name="pInstAssetMgmtNo_S"
							class="size-m" v-on:keyup.13="search()">
						<span style="padding: 5px;">-</span>
						<input type="text" v-model="pInstAssetMgmtNo_E" id="pInstAssetMgmtNo_E" name="pInstAssetMgmtNo_E"
							class="size-m" v-on:keyup.13="search()">
					</div>
				</div>
			
				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">규격명</label>
					<input type="text" v-model="pAssetStndKoNm" id="pAssetStndKoNm" name="pAssetStndKoNm" class="size-m"
						v-on:keyup.13="search()">
				</div>
			
				<div class="form-group col s12 l2">
					<label for="frdt" class="label-type01">구입일자</label>
					<div class="date-group" style="display: flex; align-items: center;">
						<div class="row form-row">
							<div class="form-group col s12 l5">
								<div class="date-form-wrap">
									<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
									<date-picker :value="buyDt_S" @input="function(value){ buyDt_S = value }"></date-picker>
									<input id="pBuyDt_Start" type="hidden" name="targetname" data-vv-as="날짜 " v-model="buyDt_S">
								</div>
							</div>
							<div class="form-group col s12 l5">
								<div class="date-form-wrap">
									<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
									<date-picker :value="buyDt_E" @input="function(value){ buyDt_E = value }"></date-picker>
									<input id="pBuyDt_End" type="hidden" name="targetname" data-vv-as="날짜 " v-model="buyDt_E">
								</div>
							</div>
						</div>
					</div>
				</div>
			
				<div class="form-group col s12 l2">
					<label for="pSearchType" class="label-type01">구입단가</label>
					<div class="input-group" style="display: flex; align-items: center;">
						<input type="text" v-model="pBuyUprice_S" id="pBuyUprice_S" name="pBuyUprice_S" class="size-m"
							v-on:keyup.13="search()">
						<span style="padding: 5px;">-</span>
						<input type="text" v-model="pBuyUprice_E" id="pBuyUprice_E" name="pBuyUprice_E" class="size-m"
							v-on:keyup.13="search()">
					</div>
				</div>
			</div>

			<div v-show="isSectionVisible">
				<div class="row form-row">
					<div class="form-group col s12 l2">
						<label for="pServiceType" class="label-type01">회계구분</label>
						<div class="select-group" style="display: flex; align-items: center;">
							<select class="size-m" v-model="pAcntsSeCd" name="pAcntsSeCd" id="pAcntsSeCd">
								<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0030', 'all', '', '', 'CD1')"
									v-bind:value="item.CD">{{item.CD_NM}}</option>
							</select>
						</div>
					</div>
			
					<div class="form-group col s12 l2">
						<label for="pServiceType" class="label-type01">자산구분</label>
						<div class="select-group" style="display: flex; align-items: center;">
							<select class="size-m" v-model="pAstDsCd" name="pAstDsCd" id="pAstDsCd">
								<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0034', 'all', '', '', 'CD1')"
									v-bind:value="item.CD">{{item.CD_NM}}</option>
							</select>
						</div>
					</div>
			
					<div class="form-group col s12 l2">
						<label for="pServiceType" class="label-type01">취득구분</label>
						<div class="select-group" style="display: flex; align-items: center;">
							<select class="size-m" v-model="pAcqSeCd" name="pAcqSeCd" id="pAcqSeCd">
								<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'GM0010', 'all', '', '', 'CD1')"
									v-bind:value="item.CD">{{item.CD_NM}}</option>
							</select>
						</div>
					</div>
			
					<div class="form-group col s12 l2">
						<label for="frdt" class="label-type01">취득정리일자</label>
						<div class="date-group" style="display: flex; align-items: center;">
							<div class="row form-row">
								<div class="form-group col s12 l5">
									<div class="date-form-wrap">
										<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
										<date-picker :value="acqArngDt_S"
											@input="function(value){ acqArngDt_S = value }"></date-picker>
										<input id="pAcqArngDt_Start" type="hidden" name="targetname" data-vv-as="날짜 "
											v-model="acqArngDt_S">
									</div>
								</div>
								<div class="form-group col s12 l5">
									<div class="date-form-wrap">
										<a href="#!" class="size-m"><span class="icon icon-calendar"></span></a>
										<date-picker :value="acqArngDt_E"
											@input="function(value){ acqArngDt_E = value }"></date-picker>
										<input id="pAcqArngDt_End" type="hidden" name="targetname" data-vv-as="날짜 "
											v-model="acqArngDt_E">
									</div>
								</div>
							</div>
						</div>
					</div>
			
					<div class="form-group col s12 l2">
						<label for="pServiceType" class="label-type01">비고</label>
						<div class="input-group" style="display: flex; align-items: center;">
							<input type="text" v-model="pRmk" id="pRmk" name="pRmk" class="size-m" v-on:keyup.13="search()">
						</div>
					</div>
				</div>
			</div>
			
			<div class="box-type01" @click="toggleSection"
				style="padding: 12px; height: 5px; display: flex; justify-content: center; align-items: center;">
				<div v-show="!isSectionVisible" style="display: flex; justify-content: center; width: 100%;">
					<span>▼</span>
				</div>
				<div v-show="isSectionVisible" style="display: flex; justify-content: center; width: 100%;">
					<span>▲</span>
				</div>
			</div>
		</div>
		
		<div style="display: flex; align-items: center;">
			<div class="col s12 l12" style="flex: 1;">
				<span class="board-info-txt size-m">총 <span>{{mainListPaging.totalCnt}}</span>건의 게시물이 있습니다. (<span>{{mainListPaging.getCurrentPage()}}</span> / {{mainListPaging.getTotalPage()}})</span>
			</div>
			<div class="col-inline btn-line right" style="display: flex; justify-content: flex-end;">
				<a href="#!" class="btn type02 size-m center-icon" @click="resetFields"><span class="icon-refresh"></span></a>
				<a href="#!" class="btn type04 size-m left-icon icon-search" @click="search()" style="margin-right: 5px;">조회</a>
				<a href="#!" class="btn type04 size-m left-icon icon-more" @click="newRow" style="margin-right: 5px;">입력</a>
				<a href="#!" class="btn type04 size-m left-icon icon-edit" @click="rowCheckClick()" style="margin-right: 5px;">수정</a>
				<a href="#!" class="btn type04 size-m left-icon icon-trashcan" @click="deleteSelectedRows()" style="margin-right: 5px;">삭제</a>
				<a href="#!" class="btn type02 size-m left-icon icon-export" @click="rowinsertDtlCheckClick()" style="margin-right: 5px;">반영</a>
				<a href="#!" class="btn type02 size-m left-icon icon-report" @click="excelDownload()" style="margin-right: 5px;">엑셀</a>
			</div>
		</div>
		
		<!-- 테이블 영역 -->
		<div class="col s12 m12 xl12">
			<div class="table-type01-wrap">
				<perfect-scrollbar style="max-height: 700px;">
					<table class="table-type01 response" id="datas-reponsive">
						<caption></caption>
						<thead class="thead-fixed">
							<tr>
								<th><input type="checkbox" v-model="selectAll" @change="toggleSelectAll" /></th>
								<th scope="col">No</th>
								<th scope="col">반영여부</th>
								<th scope="col">자산취득번호</th>
								<th scope="col">물품명</th>
								<th scope="col">규격명</th>
								<th scope="col">구입일자</th>
								<th scope="col">구입단가</th>
								<th scope="col">취득부서</th>
							</tr>
						</thead>
						<tbody v-if="mainList.data.length > 0">
							<tr v-for="(item, index) in mainList.data" v-if="mainList.getRowType(index) != 8" :key="index">
								<td><input type="checkbox" :value="index" v-model="selectedRows[index]" /></td>
								<td data-header="No" style="text-align: center;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ index + 1 }}</a></td>
								<td data-header="자산반영" style="text-align: center;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.ACQ_RFLC_NM }}</a></td>
								<td data-header="자산취득번호" style="text-align: center;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.ASSET_ACQ_NO }}</a></td>
								<td data-header="물품명" style="text-align: left;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.ASSET_CL_KO_NM }}</a></td>
								<td data-header="규격명" style="text-align: left;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.ASSET_STND_KO_NM }}</a></td>
								<td data-header="구입일자" style="text-align: center;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.BUY_DT | dateFormatter }}</a></td>
								<td data-header="구입단가" style="text-align: right;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ numberFormatter(item.BUY_UPRICE) }}</a></td>
								<td data-header="보유부서" style="text-align: left;"><a href="#!" @click="toggleCheckbox(index)" @dblclick="rowDbClick(index)">{{ item.ACQ_DEPT_NM }}</a></td>
							</tr>
						</tbody>
						<tbody v-else>
							<tr>
								<td colspan="100">검색결과가 없습니다.</td>
							</tr>
						</tbody>
					</table>
				</perfect-scrollbar>
			</div>
		
			<!-- 페이지당 Row 선택 드랍다운 메뉴 -->
			<div class="col s12 l6" style="display: flex; align-items: center; justify-content: flex-end; margin-top: 10px;">
				<div class="col s3" style="margin-top: -2px;">
					<select class="size-s" v-model="pageSize" @change="changePageSize" name="pageSize" id="pageSize">
						<option v-for="sizeOption in pageSizes" :value="sizeOption">{{ sizeOption }} 건</option>
					</select>
				</div>
				<label style="margin-left: 10px; margin-bottom: 0;">/ 페이지당</label>
			</div>
			<paging :pagingset="mainListPaging" :type="'normal'"></paging>
		</div>
	</section>
	
	<!-- 입력/수정 화면 -->
	<section class="cont_box" v-if="mainList.currentRow">
		<h3 class="h3" v-if="mainList.getRowType(mainList.rowposition) == ROWTYPE_INSERT">자산 취득(입력)</h3>
		<h3 class="h3" v-if="mainList.getRowType(mainList.rowposition) == ROWTYPE_NORMAL || mainList.getRowType(mainList.rowposition) == ROWTYPE_UPDATE">자산 취득(수정)</h3>
		<div class="box-type04">
			<div class="form-group row">
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m" for="assetAcqNo">자산취득번호</label>
					<input type="text" class="size-m" id="assetAcqNo" name="assetAcqNo" data-vv-as="자산취득번호" placeholder="자산취득번호 자동생성" v-model="mainList.currentRow.ASSET_ACQ_NO" disabled="disabled" />
				</div>

				<div class="col s12 m12 l2">
					<label class="label-type01 size-m" for="instAssetMgmtNo">기관자산번호</label>
					<input type="text" class="size-m" id="instAssetMgmtNo" name="instAssetMgmtNo" data-vv-as="기관자산번호" v-model="mainList.currentRow.INST_ASSET_MGMT_NO" />
				</div>

				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m">취득부서</label>
					<select class="size-m" name="acqDeptCd" id="acqDeptCd" v-model="mainList.currentRow.ACQ_DEPT_CD">
						<option v-for="(item, index) in deptCodeSet.data" v-bind:value="item.ORGNZT_ID">{{item.ORGNZT_NM}}</option>
					</select>
				</div>
	
				<div class="form-group col s12 m12 l2">
					<label class="label-type01 required size-m">물품목록번호</label>
					<div style="display: flex; align-items: center;">
						<input type="text" v-model="mainList.currentRow.ASSET_CL_NO" id="assetClNo" name="assetClNo" class="size-m" v-on:keyup.13="search()">
						<span style="margin-left: 5px; margin-right: 5px;">-</span>
						<input type="text" v-model="mainList.currentRow.ASSET_STND_NO" id="assetStndNo" name="assetStndNo" class="size-m" v-on:keyup.13="search()">
						<button type="button" class="btn type02 size-s" @click.prevent="modal_open('assetSearchModal'); return false;" style="width: 20px; display: flex; justify-content: center; align-items: center;">
							<span class="icon icon-search"></span>
						</button>
					</div>
				</div>
	
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m" for="acqRflcAt">반영여부</label>
					<select class="size-m" name="acqRflcAt" id="acqRflcAt" disabled="disabled"
						v-model="mainList.currentRow.ACQ_RFLC_AT">
						<option value="ALL">-전체-</option>
						<option value="N">미반영</option>
						<option value="Y">반영</option>
					</select>
				</div>
			</div>
	
			<div class="form-group row" style="margin-top:-10px;">
				<div class="col s12 m12 l4">
					<label class="label-type01 size-m">물품명</label>
					<input type="text" class="size-m" id="assetClKoNm" name="assetClKoNm" readonly="readonly" placeholder="물품목록번호 적용시 자동 생성" data-vv-as="물품명" v-model="mainList.currentRow.ASSET_CL_KO_NM" />
				</div>
				<div class="col s12 m12 l6">
					<label class="label-type01 size-m">규격명</label>
					<input type="text" class="size-m" id="assetStndKoNm" name="assetStndKoNm" readonly="readonly" placeholder="물품목록번호 적용시 자동 생성" data-vv-as="규격명" v-model="mainList.currentRow.ASSET_STND_KO_NM" />
				</div>
			</div>
	
			<div class="form-group row">
				<div class="col s12 m12 l2">
					<label class="label-type01 size-m">취득정리일자</label>
					<date-picker :value="mainList.currentRow.ACQ_ARNG_DT" @input="updateAcqArngDate" />
					<input type="text" class="size-m" id="acqArngDt" name="acqArngDt" data-vv-as="취득정리일자" v-model="mainList.currentRow.ACQ_ARNG_DT">
				</div>
				<div class="col s12 m12 l2">
					<label class="label-type01 size-m">취득일자</label>
					<date-picker :value="mainList.currentRow.ACQ_DT" @input="updateAcqDate" />
					<input type="text" class="size-m" id="acqDt" name="acqDt" data-vv-as="취득일자" v-model="mainList.currentRow.ACQ_DT">
				</div>
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m">구입일자</label>
					<date-picker :value="mainList.currentRow.BUY_DT" @input="updateBuyDate" />
					<input type="text" class="size-m" id="butDt" name="buyDt" data-vv-as="구입일자" v-model="mainList.currentRow.BUY_DT">
				</div>
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m">구입단가</label>
					<input type="text" class="size-m" id="buyUprice" name="buyUprice" maxlength="13" data-vv-as="구입단가" v-model="formattedBuyUprice" />
				</div>
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m">구입수량</label>
					<input type="text" class="size-m" id="buyQty" name="buyQty" data-vv-as="구입수량" v-model="mainList.currentRow.BUY_QTY" />
				</div>
			</div>
	
			<div class="form-group row">
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m" for="acntsSeCd">회계구분</label>
					<select class="size-m" name="acntsSeCd" id="acntsSeCd" v-model="mainList.currentRow.ACNTS_SE_CD">
						<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0030')" v-bind:value="item.CD">{{item.CD_NM}}</option>
					</select>
				</div>
	
				<div class="col s12 m12 l2">
					<label class="label-type01 required size-m" for="acqSeCd">취득구분</label>
					<select class="size-m" name="acqSeCd" id="acqSeCd" v-model="mainList.currentRow.ACQ_SE_CD">
						<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'GM0010')" v-bind:value="item.CD">{{item.CD_NM}}</option>
					</select>
				</div>
	
				<div class="col s12 m12 l2">
					<label class="label-type01 size-m" for="astDsCd">자산구분</label>
					<select class="size-m" name="astDsCd" id="astDsCd" v-model="mainList.currentRow.AST_DS_CD">
						<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0034')" v-bind:value="item.CD">{{item.CD_NM}}</option>
					</select>
				</div>
	
				<div class="col s12 m12 l2">
					<label class="label-type01 size-m" for="BdgtCd">예산구분</label>
					<select class="size-m" name="BdgtCd" id="BdgtCd" v-model="mainList.currentRow.BDGT_CD">
						<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0031')" v-bind:value="item.CD">{{item.CD_NM}}</option>
					</select>
				</div>
	
				<div class="col s12 m12 l2">
					<label class="label-type01 size-m" for="ExpnItemCd">비목구분</label>
					<select class="size-m" name="ExpnItemCd" id="ExpnItemCd" v-model="mainList.currentRow.EXPN_ITEM_CD">
						<option v-for="(item, index) in eamCommcode.getCommcode('EAM', 'CM0032')" v-bind:value="item.CD">{{item.CD_NM}}</option>
					</select>
				</div>
			</div>
	
			<div class="form-group row">
				<div class="col s12 m12 l12">
					<label class="label-type01 size-m">비고</label>
					<textarea type="text" class="size-m" id="rmk" name="rmk" rows="3" max="500" data-vv-as="비고"v-model="mainList.currentRow.RMK"></textarea>
				</div>
			</div>
		</div>
	
		<div class="btn-line right">
			<a href="#!" class="btn type02 size-m left-icon icon-checkmark" @click="saveRow">저장</a>
			<a href="#!" class="btn type01 size-m left-icon icon-close" @click="search($event)">닫기</a>
			<a href="#!" class="btn type01 size-m left-icon icon-trashcan" v-if="mainList.getRowType(mainList.rowposition) == ROWTYPE_NORMAL || mainList.getRowType(mainList.rowposition) == ROWTYPE_UPDATE" @click="messagePopup('ID_DELETE', mainList.currentRow.ASSET_ACQ_NO)">삭제</a>
			<a href="#!" class="btn type02 size-m left-icon icon-export" v-if="mainList.getRowType(mainList.rowposition) == ROWTYPE_NORMAL || mainList.getRowType(mainList.rowposition) == ROWTYPE_UPDATE" @click="messagePopup('INSERT_DTL', mainList.currentRow)">반영</a>
		</div>
	</section>
	<modal-message :modalset="messageModal" v-on:messagepoppupcallback="messagePopupCallback"></modal-message>
	
	<!-- 물품목록 조회 모달 레이어 팝업 -->
	<div class="modal-layer-wrap">
		<div id="assetSearchModal" class="modal-layer modal-large">
			<div class="modal-container">
				<div class="modal-header">
					<p class="modal-title">자산 검색</p>
				</div>
				<section class="sub_cont_box">
					<section class="cont_box" v-if="!assetmodalList.currentRow">
						<div class="box-type03">
							<div class="modal-content">
								<div class="row form-row">
									<div class="form-group col s12 l3">
										<label for="pSearchType" class="label-type01">물품규격번호</label>
										<input type="text" v-model="pModalAssetStndNo" id="pModalAssetStndNo" name="pModalAssetStndNo" class="size-m" v-on:keyup.13="searchModal()">
									</div>
	
									<div class="form-group col s12 l3">
										<label for="pSearchType" class="label-type01">물 품 명</label>
										<input type="text" v-model="pModalAssetClKoNm" id="pModalAssetClKoNm" name="pModalAssetClKoNm" class="size-m" v-on:keyup.13="searchModal()">
									</div>
	
									<div class="form-group col s12 l5">
										<label for="pSearchType" class="label-type01">규 격 명</label>
										<input type="text" v-model="pModalAssetStndKoNm" id="pModalAssetStndKoNm" name="pModalAssetStndKoNm" class="size-m" v-on:keyup.13="searchModal()">
									</div>
								</div>
							</div>
						</div>
	
						<div style="display: flex; align-items: center;">
							<div class="col s12 l12" style="flex: 1;">
								<span class="board-info-txt size-m">총 <span>{{assetmodalListPaging.totalCnt}}</span>건의 게시물이있습니다. (<span>{{assetmodalListPaging.getCurrentPage()}}</span> /{{assetmodalListPaging.getTotalPage()}})</span>
							</div>
							<div class="col-inline btn-line right" style="display: flex; justify-content: flex-end;">
								<a href="#!" class="btn type02 size-m center-icon" @click="resetModalFields"><span class="icon-refresh"></span></a>
								<a href="#!" class="btn type04 size-m left-icon icon-search" @click="searchModal()" style="margin-right: 5px;">조회</a>
								<a href="#!" class="btn type04 size-m left-icon icon-close " @click.prevent="closeModal($event)" style="margin-right: 5px;">닫기</a>
							</div>
						</div>
	
						<div class="col s12 m12 xl12">
							<div class="table-type01-wrap">
								<perfect-scrollbar style="max-height:400px;">
									<table class="table-type01 response">
										<caption></caption>
										<col width="7%" />
										<col width="9%" />
										<col width="16%" />
										<col width="23%" />
										<col width="45%" />
										<thead class="thead-fixed">
											<tr>
												<th scope="col">선택</th>
												<th scope="col">사용여부</th>
												<th scope="col">물품목록번호</th>
												<th scope="col">물품명</th>
												<th scope="col">규격명</th>
											</tr>
										</thead>
										<tbody v-if="assetmodalList.data.length > 0">
											<tr v-for="(item, index) in assetmodalList.data"
												v-if="assetmodalList.getRowType(index) != 8">
												<td data-header="선택"><a href="#!" @click="messagePopup('ASSET_SELECT', index)"><span class="icon-checkmark"></span></a></td>
												<td data-header="사용여부"><a href="#!" @dblclick="messagePopup('ASSET_SELECT', index)">{{ item.USE_AT }}</a></td>
												<td data-header="물품목록번호"><a href="#!" @dblclick="messagePopup('ASSET_SELECT', index)">{{ item.CL_STND_CD }}</a></td>
												<td data-header="물품명" style="text-align: left;"><a href="#!" @dblclick="messagePopup('ASSET_SELECT', index)">{{ item.ASSET_CL_KO_NM }}</a></td>
												<td data-header="규격명" style="text-align: left;"><a href="#!" @dblclick="messagePopup('ASSET_SELECT', index)">{{ item.ASSET_STND_KO_NM }}</a></td>
											</tr>
										</tbody>
										<tbody v-else>
											<tr>
												<td colspan="100">검색결과가 없습니다.</td>
											</tr>
										</tbody>
									</table>
								</perfect-scrollbar>
							</div>
							<paging :pagingset="assetmodalListPaging" :type="'normal'"></paging>
						</div>
					</section>
				</section>
			</div>
		</div>
	</div>
</section>

<script type="text/javascript">

/*******************************************************************************************************************************************************************
 * vue start
 ********************************************************************************************************************************************************************/
var vm = new Vue({
	el: '#app',

	/* 사용할 데이터 Set */
	data: function() {
		return {
			mainList: new Dataset(),
			assetmodalList: new Dataset(),
			initialState: {
				buyDt_S: '',
				buyDt_E: '',
				acqDt_S: '',
				acqDt_E: '',
				acqArngDt_S: '',
				acqArngDt_E: '',
				pAssetAcqNo: '',
				pAcqDeptCd: '00',
				pAssetClNo: '',
				pAssetClKoNm: '',
				pAssetStndNo: '',
				pAssetStndKoNm: '',
				//pInstAssetMgmtNo: '',
				pInstAssetMgmtNo_S: '',
				pInstAssetMgmtNo_E: '',
				pBdgtCd: '',
				pExpnItemCd: '',
				pAstDsCd: '',
				pAcntsSeCd: '',
				pAcqSeCd: '',
				pTagKindCd: '',
				pAcqRflcAt: 'ALL',
				pBuyUprice_S: '',
				pBuyUprice_E: '',
				pRmk: '',
			},
			initialModalState: {
				pModalAssetClKoNm: '',
				pModalAssetStndNo: '',
				pModalAssetStndKoNm: '',
			},
			buyDt_S: '',
			buyDt_E: '',
			acqDt_S: '',
			acqDt_E: '',
			acqArngDt_S: '',
			acqArngDt_E: '',
			pAssetAcqNo: '',
			pAcqDeptCd: '00',
			pAssetClNo: '',
			pAssetClKoNm: '',
			pModalAssetClKoNm: '',
			pAssetStndNo: '',
			pAssetStndKoNm: '',
			pModalAssetStndNo: '',
			pModalAssetStndKoNm: '',
			//pInstAssetMgmtNo: '',
			pInstAssetMgmtNo_S: '',
			pInstAssetMgmtNo_E: '',
			pBdgtCd: '',
			pExpnItemCd: '',
			pTagKindCd: '',
			pAstDsCd: '',
			pAcntsSeCd: '',
			pAcqSeCd: '',
			pAcqRflcAt: 'ALL',
			pBuyUprice_S: '',
			pBuyUprice_E: '',
			pRmk: '',
			messageModal: new ModalSet('acqmgmt-modal'),
			mainListPaging: new PagingSet(10, 100),
			pageSizes: [100, 300, 500, 1000, 5000],
			pageSize: 100,
			size: 100,
			assetmodalListPaging: new PagingSet(10, 100),
			deptCodeSet: new CustomcodeSet('/amanager/common/dept-list', {}),
			selectAll: false,
			selectedRows: [],
			isSectionVisible: false,
			excelData: [],
		};
	},

	/* 생성 될 때 */
	beforeCreate: function () {
	},

	/* 계산된 속성 포현 시 */
	computed: {
		formattedBuyDt: {
			get() {
				return this.dateFormatter(this.mainList.currentRow.BUY_DT);
			},
			set(value) {
				this.mainList.currentRow.BUY_DT = value.replace(/-/g, '');
			}
		},

		formattedAcqArngDt: {
			get() {
				return this.dateFormatter(this.mainList.currentRow.ACQ_ARNG_DT);
			},
			set(value) {
				this.mainList.currentRow.ACQ_ARNG_DT = value.replace(/-/g, '');
			}
		},

		formattedBuyUprice: {
			get() {
				return this.numberFormatter(this.mainList.currentRow.BUY_UPRICE);
			},
			set(value) {
				this.mainList.currentRow.BUY_UPRICE = value.replace(/,/g, '');
			}
		}
	},

	filters: {
		dateFormatter: function (value) {
			if (!value) return '';
			return value.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
		}
	},

	/* 데이터 감시 */
	watch: {
		/* 메인 화면 설정 */
		'mainList.rowposition': {
			handler: function (val, oldVal) {
				if (this.mainList.enableevent) {
					var changeYn = this.mainList.dataCompare(oldVal);
					var rowType = this.mainList.getRowType(val);
					if (!changeYn) {
						this.mainList.setDefaultRow(oldVal);
					}
					this.$validator.reset();
				}
			}
		},

		'mainList.data': {
			handler: function (val, oldVal) {
				if (this.mainList.enableevent) {
					var vm = this;
					val.filter(function (data, rowposition) {
						return Object.keys(data).some(function (colNm) {
							var diff = data[colNm] !== vm.mainList.beforeData[rowposition][colNm];
							if (diff) {
								vm.mainList.beforeData[rowposition][colNm] = data[colNm];
								vm.componentStateChange();
							}
						})
					});
				}
			},
			deep: true
		},

		'mainListPaging.currentPage': {
			handler: function (val, oldVal) {
				this.setmainList(null, val)
			}
		},
		
		/* 모달 팝업 레이어 설정 */
		'assetmodalList.rowposition': {
			handler: function (val, oldVal) {
				if (this.assetmodalList.enableevent) {
					var changeYn = this.assetmodalList.dataCompare(oldVal);
					var rowType = this.assetmodalList.getRowType(val);
					if (!changeYn) {
						this.assetmodalList.setDefaultRow(oldVal);
					}
					this.$validator.reset();
				}
			}
		},

		'assetmodalList.data': {
			handler: function (val, oldVal) {
				if (this.assetmodalList.enableevent) {
					var vm = this;
					val.filter(function (data, rowposition) {
						return Object.keys(data).some(function (colNm) {
							var diff = data[colNm] !== vm.assetmodalList.beforeData[rowposition][colNm];
							if (diff) {
								vm.assetmodalList.beforeData[rowposition][colNm] = data[colNm];
								vm.componentStateChange();
							}
						})
					});
				}
			},
			deep: true
		},

		'assetmodalListPaging.currentPage': {
			handler: function (val, oldVal) {
				this.setassetmodalList(null, val)
			}
		},
	},

	/* 마운트 된 시험수행 */
	mounted: function () {
		this.setmainList();
		document.addEventListener('keydown', this.handleEscKey);
	},

	beforeDestroy() {
		document.removeEventListener('keydown', this.handleEscKey);
	},

	/* 함수 */
	methods: {
		/* 메인 화면 set */
		setmainList: function (e, pPageNo, isExcelDownload, callback) {
			if (isNull(e) || e.keyCode == 13 || e.type == 'click' && isExcelDownload == 0) {
				var pAssetAcqNo = $('#pAssetAcqNo').val();
				//var pInstAssetMgmtNo= $('#pInstAssetMgmtNo').val();
				var pInstAssetMgmtNo_S = $('#pInstAssetMgmtNo_S').val();
				var pInstAssetMgmtNo_E = $('#pInstAssetMgmtNo_E').val();
				var pAcqDeptCd = $('#pAcqDeptCd option:selected').val();
				var pAcntsSeCd = $('#pAcntsSeCd option:selected').val();
				var pAstDsCd = $('#pAstDsCd option:selected').val();
				var pAcqSeCd = $('#pAcqSeCd option:selected').val();
				var pBdgtCd = $('#pBdgtCd option:selected').val();
				var pExpnItemCd = $('#pExpnItemCd option:selected').val();
				var pAcqRflcAt = $('#pAcqRflcAt option:selected').val();
				var pBuyUprice_S = $('#pBuyUprice_S').val();
				var pBuyUprice_E = $('#pBuyUprice_E').val();
				var pAssetClNo = $('#pAssetClNo').val();
				var pAssetClKoNm = $('#pAssetClKoNm').val();
				var pAssetStndNo = $('#pAssetStndNo').val();
				var pAssetStndKoNm = $('#pAssetStndKoNm').val();
				var pRmk = $('#pRmk').val();
				var pServiceType = $('#pServiceType option:selected').val();
				var pBuyDt_S = this.buyDt_S
				var pBuyDt_E = this.buyDt_E;
				var pAcqDt_S = this.acqDt_S
				var pAcqDt_E = this.acqDt_E;
				var pAcqArngDt_S = this.acqArngDt_S
				var pAcqArngDt_E = this.acqArngDt_E;
				var pageNo = pPageNo;
				var rowCount = this.mainListPaging.getRowCnt();

				if (isNull(pAssetAcqNo)) pAssetAcqNo = '';
				//if(isNull(pInstAssetMgmtNo))	pInstAssetMgmtNo		= '';
				if (isNull(pInstAssetMgmtNo_S)) pInstAssetMgmtNo_S = '';
				if (isNull(pInstAssetMgmtNo_E)) pInstAssetMgmtNo_E = '';
				if (isNull(pAcqDeptCd)) pAcqDeptCd = '';
				if (isNull(pAcntsSeCd)) pAcntsSeCd = '';
				if (isNull(pAstDsCd)) pAstDsCd = '';
				if (isNull(pAcqSeCd)) pAcqSeCd = '';
				if (isNull(pBdgtCd)) pBdgtCd = '';
				if (isNull(pExpnItemCd)) pExpnItemCd = '';
				if (isNull(pAcqRflcAt)) pAcqRflcAt = '';
				if (isNull(pBuyUprice_S)) pBuyUprice_S = '';
				if (isNull(pBuyUprice_E)) pBuyUprice_E = '';
				if (isNull(pAssetClNo)) pAssetClNo = '';
				if (isNull(pAssetClKoNm)) pAssetClKoNm = '';
				if (isNull(pAssetStndNo)) pAssetStndNo = '';
				if (isNull(pAssetStndKoNm)) pAssetStndKoNm = '';
				if (isNull(pBuyDt_S)) pBuyDt_S = '';
				if (isNull(pBuyDt_E)) pBuyDt_E = '';
				if (isNull(pAcqDt_S)) pAcqDt_S = '';
				if (isNull(pAcqDt_E)) pAcqDt_E = '';
				if (isNull(pAcqArngDt_S)) pAcqArngDt_S = '';
				if (isNull(pAcqArngDt_E)) pAcqArngDt_E = '';
				if (isNull(pRmk)) pRmk = '';
				if (isNull(pageNo)) pageNo = 1;
				if (isNull(rowCount)) rowCount = 50;
				// 엑셀 다운로드 로직
				if (isExcelDownload == 1) {
					rowCount = 9999;
					pageNo = 1;
				}
				
				var param = {
					'pAssetAcqNo': pAssetAcqNo,
					//'pInstAssetMgmtNo' 	: pInstAssetMgmtNo,
					'pInstAssetMgmtNo_S': pInstAssetMgmtNo_S,
					'pInstAssetMgmtNo_E': pInstAssetMgmtNo_E,
					'pAcqDeptCd': pAcqDeptCd,
					'pAcntsSeCd': pAcntsSeCd,
					'pAstDsCd': pAstDsCd,
					'pAcqSeCd': pAcqSeCd,
					'pBdgtCd': pBdgtCd,
					'pExpnItemCd': pExpnItemCd,
					'pAcqRflcAt': pAcqRflcAt,
					'pBuyUprice_S': pBuyUprice_S,
					'pBuyUprice_E': pBuyUprice_E,
					'pAssetClNo': pAssetClNo,
					'pAssetClKoNm': pAssetClKoNm,
					'pAssetStndNo': pAssetStndNo,
					'pAssetStndKoNm': pAssetStndKoNm,
					'pBuyDt_S': pBuyDt_S,
					'pBuyDt_E': pBuyDt_E,
					'pAcqDt_S': pAcqDt_S,
					'pAcqDt_E': pAcqDt_E,
					'pAcqArngDt_S': pAcqArngDt_S,
					'pAcqArngDt_E': pAcqArngDt_E,
					'pRmk': pRmk,
					'pPageNo': pageNo,
					'pRowCount': rowCount
				};
				
				var self = this;
				var returnVal = acqMgmtApi.getAsstAcqMgmtList(param, true);
				returnVal.then(function (response) {
					self.mainList.setData(response.data);
					self.excelData = response.data;
					if (self.mainList.getRowCount() > 0) {
						var totalCnt = self.mainList.data[0].CNT;
						self.mainListPaging.setTotalCnt(totalCnt);
					} else {
						self.mainListPaging.setTotalCnt(0);
					}
					if (typeof callback === "function") {
						callback();
					}
				});
			}
		},

		/*  페이지 당 Row 선택 */
		changePageSize: function () {
			this.mainListPaging.setRowCnt(this.pageSize);
			this.setmainList(null, 1);
		},
		
		/* 자산 검색 모달 set */
		setassetmodalList: function (e, pPageNo) {
			if (isNull(e) || e.keyCode == 13 || e.type == 'click') {
				var pModalAssetClKoNm = $('#pModalAssetClKoNm').val();
				var pModalAssetStndKoNm = $('#pModalAssetStndKoNm').val();
				var pModalAssetStndNo = $('#pModalAssetStndNo').val();
				var pageNo = pPageNo;
				var rowCount = this.assetmodalListPaging.getRowCnt();

				if (isNull(pModalAssetClKoNm)) pModalAssetClKoNm = '';
				if (isNull(pModalAssetStndKoNm)) pModalAssetStndKoNm = '';
				if (isNull(pModalAssetStndNo)) pModalAssetStndNo = '';
				if (isNull(pageNo)) pageNo = 1;
				if (isNull(rowCount)) rowCount = 20;

				var param = {
					'pModalAssetClKoNm': pModalAssetClKoNm,
					'pModalAssetStndKoNm': pModalAssetStndKoNm,
					'pModalAssetStndNo': pModalAssetStndNo,
					'pPageNo': pageNo,
					'pRowCount': rowCount
				};

				var self = this;
				var returnVal = commonSearchApi.getAsstNoList(param, true);
				returnVal.then(function (response) {
					self.assetmodalList.setData(response.data);
					if (self.assetmodalList.getRowCount() > 0) {
						var totalCnt = self.assetmodalList.data[0].CNT;
						self.assetmodalListPaging.setTotalCnt(totalCnt);
					} else {
						self.assetmodalListPaging.setTotalCnt(0);
					}
				});
			}
		},

		/* 일반 조회 */
		search: function (e, pPageNo) {
			var pageNo = this.mainListPaging.getCurrentPage();

			if (pageNo == 1) {
				this.setmainList(e, pPageNo, 0);
			} else {
				this.mainListPaging.movePage(1);
			}
		},

		/* 모달 조회 */
		searchModal: function (e, pPageNo) {
			var pageNo = this.assetmodalListPaging.getCurrentPage();

			if (pageNo == 1) {
				this.setassetmodalList(e, pPageNo);
			} else {
				this.assetmodalListPaging.movePage(1);
			}
		},
		
		/* 데이터 형식 변환 */
		updateBuyDate(value) {
			this.mainList.currentRow.BUY_DT = value;
		},

		updateAcqArngDate(value) {
			this.mainList.currentRow.ACQ_ARNG_DT = value;
		},

		updateAcqDate(value) {
			this.mainList.currentRow.ACQ_DT = value;
		},

		numberFormatter(value) {
			if (!value) return '';
			return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		},

		/* ACQ MGMT 리스트 신규행 추가 */
		newRow: function () {
			var now = new Date();
			var year = now.getFullYear();
			var month = ('0' + (now.getMonth() + 1)).slice(-2);
			var day = ('0' + now.getDate()).slice(-2);
			var formattedDate = year + '-' + month + '-' + day;
			var addObj = {
				'ASSET_ACQ_NO': '',
				'INST_ASSET_MGMT_NO': '',
				'ACQ_DEPT_CD': '',
				'ACNTS_SE_CD': '',
				'ACQ_SE_CD': '',
				'ASSET_CL_NO': '',
				'ASSET_STND_NO': '',
				'AST_DS_CD': '',
				'BDGT_CD': '',
				'EXPN_ITEM_CD': '',
				'ACQ_DT': formattedDate,
				'ACQ_ARNG_DT': '',
				'BUY_DT': '',
				'BUY_QTY': '',
				'BUY_UPRICE': '',
				'RMK': '',
				'REGUSER_ID': '',
				'REG_DATE': '',
				'ACQ_RFLC_AT': 'N',
				'ASSET_ITEM_CD': '',
				'AGENCY_ID': '',
				'RMK': '',
			};
			var newRowPosition = this.mainList.addRow(addObj);
		},

		/* ACQ MGMT 리스트 저장,수정 */
		saveRow: function () {

			// 폼 입력 검증
			if (!this.mainList.currentRow.ACQ_DEPT_CD) {this.messageModal.openModal('message', '부서코드 미입력', '부서코드(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.ASSET_CL_NO) {this.messageModal.openModal('message', '물품코드 미입력', '물품목록번호(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.BUY_DT) {this.messageModal.openModal('message', '구입일자 미입력', '구입일자(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.BUY_UPRICE) {this.messageModal.openModal('message', '구입단가 미입력', '구입단가(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.BUY_QTY) {this.messageModal.openModal('message', '구입수량 미입력', '구입수량(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.ACNTS_SE_CD) {this.messageModal.openModal('message', '회계구분 미입력', '회계구분(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}
			if (!this.mainList.currentRow.ACQ_SE_CD) {this.messageModal.openModal('message', '취득구분 미입력', '취득구분(은/는) 필수 입력 항목입니다.', 'small', '', ''); return;}

			var validate = this.$validator.validateAll();
			var self = this;

			validate.then(function (response) {
				if (response) {
					var rowposition = self.mainList.rowposition;
					var checkedIndex = self.selectedRows.findIndex(row => row === true);
					const selectedRow = self.mainList.data[checkedIndex];
					var rowType1 = self.mainList.getRowType(rowposition);
					var rowType2 = self.mainList.getRowType(checkedIndex);
					var returnVal = null;

					//신규 입력 시 저장
					if (rowType1 == ROWTYPE_INSERT || rowType2 == ROWTYPE_INSERT) {
						returnVal = acqMgmtApi.assetAcqInsert(self.mainList.currentRow, false);
					}
					//수정 시 저장
					else if (rowType1 == ROWTYPE_UPDATE || rowType2 == ROWTYPE_UPDATE) {
						returnVal = acqMgmtApi.assetAcqUpdate(self.mainList.currentRow, false);
					} else {
						notifySubmit('info', 'ACQ MGMT 저장', '저장할 내역이 없습니다.', 'icon-message');
					}

					if (!isNull(returnVal)) {
						returnVal.then(function (response) {
							var data = response.data;
							notifySubmit('success', 'ACQ MGMT 저장', '저장이 완료되었습니다.', 'icon-save');
							self.setmainList(null, self.mainListPaging.currentPage, 0);
						}).catch(function (error) {
							notifySubmit('warning', 'ACQ MGMT 저장', '저장에 실패하였습니다.', 'icon-caution');
						});
					}
				} else {
					notifySubmit('warning', 'ACQ MGMT 저장', '입력항목을 확인해주세요.', 'icon-caution');
				}
			});
			self.resetSelectedRows();
		},

		/* ACQ MGMT 리스트 삭제(로우단위) */
		deleteRows(assetAcqNos) {
			var self = this;
			var promises = assetAcqNos.map(assetAcqNo => {
				var index = this.mainList.data.findIndex(row => row.ASSET_ACQ_NO === assetAcqNo);
				if (index !== -1) {
					var rowType = this.mainList.getRowType(index);
					
					if (rowType !== ROWTYPE_INSERT) {
						return acqMgmtApi.assetAcqDelete(assetAcqNo, true).then(function (response) {
							return {assetAcqNo, success: true};
						}).catch(function (error) {
							return {assetAcqNo, success: false};
						});
					} else {
						return Promise.resolve({assetAcqNo, success: true});
					}
				} else {
					console.error("유효하지 않은 ASSET_ACQ_NO입니다.");
					return Promise.resolve({assetAcqNo, success: false});
				}
			});
			// Promise 로직 모두 완료 후 다음 단계 진입
			Promise.all(promises).then(results => {
				results.forEach(result => {
					if (result.success) {
						notifySubmit('success', 'ACQ MGMT 삭제', `${result.assetAcqNo} 자산의 삭제가 완료되었습니다.`, 'icon-trashcan');
					} else {
						notifySubmit('warning', 'ACQ MGMT 삭제', `${result.assetAcqNo} 자산의 삭제에 실패하였습니다.`, 'icon-caution');
					}
				});
				self.setmainList(null, self.mainListPaging.currentPage, 0);
				self.resetSelectedRows();
			});
		},

		/* 삭제 시 체크박스 선택 및 반영여부 상태 확인 */
		deleteSelectedRows() {
			const selectedAssetAcqNos = [];
			let hasReflectedAsset = false;
			
			this.selectedRows.forEach((isSelected, index) => {
				if (isSelected) {
					const selectedRowData = this.mainList.data[index];
					if (selectedRowData && selectedRowData.ASSET_ACQ_NO) {
						if (selectedRowData.ACQ_RFLC_AT === 'N') {
							selectedAssetAcqNos.push(selectedRowData.ASSET_ACQ_NO);
						} else if (selectedRowData.ACQ_RFLC_AT === 'Y') {
							hasReflectedAsset = true;
						}
					}
				}
			});
			
			// 이미 반영된 자산 로직 처리
			if (hasReflectedAsset) {
				this.messageModal.openModal('message', '이미 반영된 자산', '반영 처리된 취득 자산은 삭제 할 수 없습니다.', 'middle', '', '');
			} else if (selectedAssetAcqNos.length > 0) {
				this.messagePopup('ROW_DELETE', selectedAssetAcqNos);
			} else {
				this.messageModal.openModal('message', '선택된 자산 없음', '삭제할 자산을 선택 해주세요.', 'middle', '', '');
			}
		},

		/* 자산 삭제(수정화면) */
		deleteAssetByAcqNo: function (assetAcqNo) {
			var self = this;
			var returnVal = acqMgmtApi.assetAcqDelete(assetAcqNo, true);

			returnVal.then(function (response) {
				var data = response.data;
				notifySubmit('success', 'ACQ MGMT 삭제', '삭제가 완료되었습니다.', 'icon-trashcan');
				self.setmainList(null, self.mainListPaging.currentPage, 0);

			}).catch(function (error) {
				notifySubmit('warning', 'ACQ MGMT 삭제', '삭제에 실패하였습니다.', 'icon-caution');
			});
		},

		/* ACQ MGMT 리스트 상태 변경에 따른 컴포넌트 상태변경 */
		componentStateChange: function () {
		},

		/* 수정버튼 클릭시 체크박스 선택 및 반영여부 상태 확인 */
		rowCheckClick() {
			const checkedIndex = this.selectedRows.findIndex(row => row === true);
			// 체크 상태 확인
			if (checkedIndex !== -1) {
				const selectedRow = this.mainList.data[checkedIndex];

				if (selectedRow.ACQ_RFLC_AT === 'Y') {
					this.messageModal.openModal('message', '이미 반영된 자산', '반영 처리된 취득 자산은 수정할 수 없습니다.', 'middle', '', '');
				} else if (selectedRow.ACQ_RFLC_AT === 'N') {
					this.mainList.setRowType(checkedIndex, this.ROWTYPE_UPDATE);
					this.mainList.rowposition = checkedIndex;
					this.mainList.currentRow = this.mainList.data[checkedIndex];
				} else {
					console.log("ACQ_RFLC_AT의 값이 유효하지 않습니다.");
				}
			} else {
				this.messageModal.openModal('message', '선택된 자산 없음', '수정할 자산을 선택 해주세요.', 'middle', '', '');
			}
		},

		/* 자산반영 클릭시 체크박스 선택 및 반영여부 상태 확인 */
		rowinsertDtlCheckClick() {
			const selectedAssetAcqNos = [];
			let hasAlreadyReflectedAsset = false;

			this.selectedRows.forEach((isSelected, index) => {
				if (isSelected) {
					const selectedRow = this.mainList.data[index];
					console.log("selectedRow : " + selectedRow);
					if (selectedRow && selectedRow.ACQ_RFLC_AT === 'N') {
						selectedAssetAcqNos.push(selectedRow.ASSET_ACQ_NO);
					} else {
						hasAlreadyReflectedAsset = true;
					}
				}
			});

			if (selectedAssetAcqNos.length > 0) {
				if (hasAlreadyReflectedAsset) {
					this.messageModal.openModal('message', '자산 반영 불가', '선택된 자산 중 이미 반영된 자산이 있거나 <br/> 반영할 자산이 없습니다.', 'middle', '', '');
				} else {
					this.messagePopup('INSERT_DTL', selectedAssetAcqNos);
				}
			} else {
				this.messageModal.openModal('message', '자산 반영 불가', '선택된 자산 중 이미 반영된 자산이 있거나 <br/> 반영할 자산이 없습니다.', 'middle', '', '');
			}
		},

		/* 특정 Row 더블클릭시 수정창 [index값 기준] open */
		rowDbClick: function (index) {
			var nRowType = this.mainList.setRowType(0, this.ROWTYPE_UPDATE);
			const selectedRow = this.mainList.data[index];
			// index값 확인
			if (!selectedRow) {
				console.error("선택된 행이 유효하지 않습니다.");
				return;
			}
			if (selectedRow.ACQ_RFLC_AT === 'Y') {
				this.messageModal.openModal('message', '이미 반영된 자산', '이미 반영된 자산은 수정할 수 없습니다.', 'middle', '', '');
			} else if (selectedRow.ACQ_RFLC_AT === 'N') {
				this.mainList.selectRow(index);
			}
		},

		/* 자산 반영 */
		async insertDtlRow() {
			var response = await this.$validator.validateAll();
			var self = this;

			if (response) {
				var selectedAssetAcqNos = [];
				self.selectedRows.forEach((isSelected, index) => {
					if (isSelected) {
						var selectedRow = self.mainList.data[index];
						if (selectedRow && selectedRow.ACQ_RFLC_AT === 'N') {
							selectedAssetAcqNos.push(selectedRow.ASSET_ACQ_NO);
						}
					}
				});

				if (selectedAssetAcqNos.length > 0) {
					try {
						for (const assetAcqNo of selectedAssetAcqNos) {
							console.log("반영여부 업데이트시 추출한 취득번호 값 : " + assetAcqNo);
							await acqMgmtApi.assetAcqRflcAtUpdate(assetAcqNo, false);
						}
						notifySubmit('success', '자산 반영', '반영이 완료되었습니다.', 'icon-save');

						for (const assetAcqNo of selectedAssetAcqNos) {
							var entry = {ASSET_ACQ_NO: assetAcqNo};
							await acqMgmtApi.assetDtlInsert(entry, false);
						}
						notifySubmit('success', '자산 상세 등록', '자산 상세 등록이 완료되었습니다.', 'icon-save');
						self.setmainList(null, self.mainListPaging.currentPage, 0);
					} catch (error) {
						notifySubmit('warning', '자산 반영 또는 등록', '반영 또는 등록에 실패하였습니다.', 'icon-caution');
					}
				} else {
					notifySubmit('warning', '자산 반영', '선택된 자산이 없거나 이미 반영된 자산입니다.', 'icon-caution');
				}
			} else {
				notifySubmit('warning', '자산 반영', '입력항목을 확인해주세요.', 'icon-caution');
			}
		},

		/* 자산 반영 로직 */
		insertDtl: function () {
			var validate = this.$validator.validateAll();
			var self = this;

			validate.then(function (response) {
				if (response) {
					var rowposition = self.mainList.rowposition;
					var rowType1 = self.mainList.getRowType(rowposition);
					var returnVal = null;

					returnVal = acqMgmtApi.assetDtlInsert(self.mainList.currentRow, false)
					if (!isNull(returnVal)) {
						returnVal.then(function (response) {
							var data = response.data;
							notifySubmit('success', '자산 반영', '반영이 완료되었습니다.', 'icon-save');
							return Promise.all([
								acqMgmtApi.assetAcqRflcAtUpdate(self.mainList.currentRow, false)
							]);
						})
						.then(function () {
							self.setmainList(null, self.mainListPaging.currentPage, 0);
						}).catch(function (error) {
							notifySubmit('warning', '자산 반영', '반영에 실패하였습니다.', 'icon-caution');
						});
					}
				} else {
					notifySubmit('warning', '자산 반영', '입력항목을 확인해주세요.', 'icon-caution');
				}
			});
		},

		/* 물품 목록 번호 적용 */
		selectAsset: function (row) {
			var self = this;
			var rowType = this.assetmodalList.getRowType(row);
			var getAssetClNo = this.assetmodalList.getColumn(row, 'ASSET_CL_NO');
			var getAssetStndNo = this.assetmodalList.getColumn(row, 'ASSET_STND_NO');
			var getAssetClKoNm = this.assetmodalList.getColumn(row, 'ASSET_CL_KO_NM');
			var getAssetStndKoNm = this.assetmodalList.getColumn(row, 'ASSET_STND_KO_NM');

			if (!this.mainList.currentRow) {
				this.pAssetClNo = getAssetClNo;
				this.pAssetStndNo = getAssetStndNo;
			} else if (this.mainList.currentRow !== null) {
				this.mainList.currentRow.ASSET_CL_NO = getAssetClNo;
				this.mainList.currentRow.ASSET_STND_NO = getAssetStndNo;
				this.mainList.currentRow.ASSET_CL_KO_NM = getAssetClKoNm;
				this.mainList.currentRow.ASSET_STND_KO_NM = getAssetStndKoNm;
			}
			modal_close('assetSearchModal');
		},

		/* 메세지창 띄우기 */
		messagePopup: function (pId, pData) {
			console.log('messagePopup 호출됨', pId, pData); // 디버깅용 로그
			var title = '확인';
			var cont = '해당 작업을 수행하시겠습니까?';
			var pGb = 'confirm';

			switch (pId) {
				// 수정화면 삭제
				case 'ID_DELETE':
					title = '삭제';
					cont = '해당 자산을 삭제하시겠습니까?<br /><span style="color:#c90000;">(해당 자산 관련 정보들이 영구히 삭제 됩니다.)</span>';
					break;
				// 체크박스 선택 삭제
				case 'ROW_DELETE':
					title = '삭제';
					cont = '선택된 자산을 모두 삭제하시겠습니까?<br /><span style="color:#c90000;">(해당 자산 관련 정보들이 영구히 삭제 됩니다.)</span>';
					break;
				// 모달창 자산 선택
				case 'ASSET_SELECT':
					title = '선택 및 적용';
					var index = pData;
					var selectedRow = this.assetmodalList.data[index];

					if (selectedRow) {
						var displayAssetClNo = selectedRow.ASSET_CL_NO;
						var displayAssetStndNo = selectedRow.ASSET_STND_NO;
						var displayAssetClNm = selectedRow.ASSET_CL_KO_NM;
						var displayAssetStndNm = selectedRow.ASSET_STND_KO_NM;

						cont = '해당 자산 <br /><br /> 물품번호 :  ' + displayAssetClNo + '-' + displayAssetStndNo +
							'<br /> 물품명 :  ' + displayAssetClNm +
							'<br /> 규격명 :  ' + displayAssetStndNm +
							'<br /><br />을(를) 선택하시겠습니까?';
					} else {
						cont = '선택한 자산 정보를 가져올 수 없습니다.';
					}
					break;
				// 자산 반영
				case 'INSERT_DTL':
					title = '반영';
					cont = '선택된 자산을 반영하시겠습니까?'
					break;
			}
			this.messageModal.openModal(pGb, title, cont, 'middle', pId, pData);
		},

		/* 메시지 콜백 */
		messagePopupCallback: function (pGb, pId, pData) {
			if (pGb != 'confirm') return;

			switch (pId) {
				case 'ID_DELETE':
					this.deleteAssetByAcqNo(pData);
					break;

				case 'ROW_DELETE':
					this.deleteRows(pData);
					break;

				case 'ASSET_SELECT':
					this.selectAsset(pData);
					break;

				case 'INSERT_DTL':
					this.insertDtlRow(pData);
					break;
			}
		},

		/* 검색조건 초기화 */
		resetFields() {
			Object.assign(this.$data, JSON.parse(JSON.stringify(this.initialState)));
		},
		
		/* 모달 검색조건 초기화 */
		resetModalFields() {
			Object.assign(this.$data, JSON.parse(JSON.stringify(this.initialModalState)));
		},

		/* 모달 레이어 팝업 Close */
		closeModal(event) {
			if (!this.mainList.currentRow) {
				modal_close('assetSearchModal');
				this.search(event);
			} else {
				modal_close('assetSearchModal');
			}
		},

		/* 체크박스 선택시 데이터 저장*/
		toggleRowSelection(index) {
			if (this.selectedRows.includes(index)) {
				this.selectedRows = this.selectedRows.filter(i => i !== index);
				this.mainList.deselectRow(index);
			} else {
				this.selectedRows.push(index);
				this.mainList.selectRow(index);
			}
		},

		/* 프로세스 적용 후 체크 선택 해제 */
		resetSelectedRows() {
			this.selectedRows = [];
			this.selectAll = false;
		},

		/* 아코디언 설정 */
		toggleSection() {
			this.isSectionVisible = !this.isSectionVisible;
		},

		/* 체크박스 토글 */
		toggleCheckbox(index) {
			this.$set(this.selectedRows, index, !this.selectedRows[index]);
		},

		/* 모든 체크박스 토글  */
		toggleSelectAll() {
			this.selectedRows = this.mainList.data.map(() => this.selectAll);
		},

		/* ESC 버튼 다운시 핸들러 */
		handleEscKey(event) {
			if (event.key === 'Escape' || event.key === 'Esc') {
				this.closeModal(event);
			}
		},

		/* 엑셀 다운로드 */
		excelDownload() {
			// 데이터 조회
			this.setmainList(null, 1, 1, () => {
				let date = moment().format('YYYY-MM-DD');
				let filename = '자산취득_' + date + '.xlsx';

				const dataForExcel = this.excelData.map((item, index) => ({
					'No': index + 1,
					'반영여부': item.ACQ_RFLC_NM,
					'자산취득번호': item.ASSET_ACQ_NO,
					'기관자산번호': item.INST_ASSET_MGMT_NO,
					'물품목록번호': item.ASSET_CL_STND_CD,
					'물품명': item.ASSET_CL_KO_NM,
					'규격명': item.ASSET_STND_KO_NM,
					'취득일자': item.ACQ_DT,
					'구입일자': item.BUY_DT,
					'구입수량': item.BUY_QTY,
					'구입단가': item.BUY_UPRICE,
					'취득부서': item.ACQ_DEPT_NM,
					'회계구분': item.ACNTS_SE_NM,
					'취득구분': item.ACQ_SE_NM,
					'자산구분': item.AST_DS_NM,
				}));

				// 데이터로 시트 생성
				const workSheet = XLSX.utils.json_to_sheet(dataForExcel);

				// 열 넓이 설정
				const colWidths = [
					{wpx: 30},			// No
					{wpx: 50},			// 반영여부
					{wpx: 110},			// 자산취득번호
					{wpx: 110},			// 기관자산번호
					{wpx: 120},			// 물품목록번호
					{wpx: 200},			// 물품명
					{wpx: 300},			// 규격명
					{wpx: 70},			// 취득일자
					{wpx: 70},			// 구입일자
					{wpx: 70},			// 구입수량
					{wpx: 70},			// 구입단가
					{wpx: 150},			// 취득부서
					{wpx: 80},			// 회계구분
					{wpx: 80},			// 취득구분
					{wpx: 80},			// 자산구분
				];
				workSheet['!cols'] = colWidths;

				// 워크북 생성 및 시트 추가
				const workBook = XLSX.utils.book_new();
				XLSX.utils.book_append_sheet(workBook, workSheet, '자산취득');

				XLSX.writeFile(workBook, filename);
			});
		},
	}
});
/*******************************************************************************************************************************************************************
 * vue end
 ********************************************************************************************************************************************************************/


/*******************************************************************************************************************************************************************
 * javascript start
 ********************************************************************************************************************************************************************/

function handleNullValues(row) {
     Object.keys(row).forEach(function(key) {
         if (row[key] === '') {
             row[key] = null;
         }
     });
     return row;
}
 
/*******************************************************************************************************************************************************************
 * javascript end
 ********************************************************************************************************************************************************************/
   
</script>

<!--*******************************************************************************************************************************************************************
 * style start
 *******************************************************************************************************************************************************************-->
<style>
	.thead-fixed {
		position: sticky;
		top: 0;
		z-index: 1;
		background-color: #FFF;
	}

	.sub_cont_wrap {
		width: 97%;
		margin: 0 auto;
		margin-top: 40px;
		margin-bottom: 60px;
	}

	.sub_cont_wrap .sub_cont_box {
		padding: 20px;
		margin-bottom: 0px;
	}

	.row .col.l2 {
		width: 20%;
		margin-left: auto;
		left: auto;
		right: auto
	}

	.row .col.l4 {
		width: 40%;
		margin-left: auto;
		left: auto;
		right: auto
	}

	.row .col.l5 {
		width: 50%;
		margin-left: auto;
		left: auto;
		right: auto
	}

	.row .col.l6 {
		width: 60%;
		margin-left: auto;
		left: auto;
		right: auto
	}

	.date-form-wrap .size-m {
		font-size: 13.5px;
	}

	th,	td {
		/* 텍스트 줄바꿈 방지 */
		white-space: nowrap;
		/* 넘치는 텍스트 숨김 */
		overflow: hidden;
		text-overflow: ellipsis;
	}
	
</style>

<!--*******************************************************************************************************************************************************************
 * style end
 *******************************************************************************************************************************************************************-->
